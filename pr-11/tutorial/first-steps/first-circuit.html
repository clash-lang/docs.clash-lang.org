<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Your first circuit - Clash Tutorial</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Clash Tutorial</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="your-first-circuit"><a class="header" href="#your-first-circuit">Your first circuit</a></h1>
<p>The very first circuit that we will build is the "classic" multiply-and-accumulate (MAC) circuit.
This circuit is as simple as it sounds, it multiplies its inputs and accumulates them.
Before we describe any logic, we must first create the file we will be working on and input some preliminaries:</p>
<ul>
<li>
<p>Create the file:</p>
<pre><code>MAC.hs
</code></pre>
</li>
<li>
<p>Write on the first line the module header:</p>
<pre><code class="language-haskell">module MAC where
</code></pre>
<p>Module names must always start with a <strong>C</strong>apital letter.
Also make sure that the file name corresponds to the module name.</p>
</li>
<li>
<p>Add the import statement for the Clash prelude library:</p>
<pre><code class="language-haskell">import Clash.Prelude
</code></pre>
<p>This imports all the necessary functions and datatypes for circuit description.</p>
</li>
</ul>
<p>We can now finally start describing the logic of our circuit, starting with just the multiplication and addition:</p>
<pre><code class="language-haskell">ma acc (x, y) = acc + x * y
</code></pre>
<p>The circuit we just wrote is a combinational circuit: no registers are inserted (you describe explicitly where Clash will insert registers, as we'll later see).
We usually refer to circuits as <em>functions</em>, similar to programming languages such as C, Python, or Haskell.
In this case, the function we just defined is called <code>ma</code>.
Its first argument is <code>acc</code>, its second is <code>(x, y)</code> - a composite type called a tuple.
This component is "unpacked", and its first element is called <code>x</code>, its second <code>y</code>.
Everything to the right of the equals symbol is <code>ma</code>'s result.
If you followed the instructions of running the interpreter side-by-side, you can already test this function:</p>
<pre><code class="language-haskell">&gt;&gt;&gt; ma 4 (8, 9)
76
&gt;&gt;&gt; ma 2 (3, 4)
14
</code></pre>
<p>We can also examine the inferred type of <code>ma</code> in the interpreter:</p>
<pre><code class="language-haskell">&gt;&gt;&gt; :t ma
ma :: Num a =&gt; a -&gt; (a, a) -&gt; a
</code></pre>
<p>You should read this as follows:</p>
<ul>
<li>
<p><strong><code>ma ::</code></strong>, <code>ma</code> is of type…</p>
</li>
<li>
<p><strong><code>Num a</code></strong>, there is some type called <code>a</code> that is a <code>Num</code>.
Examples of instances of <code>Num</code> are <code>Int</code>, <code>Signed 16</code>, <code>Index 32</code>, and <code>Float</code>.</p>
</li>
<li>
<p><strong><code>a</code></strong>, <code>ma</code>'s first argument is of type <code>a</code></p>
</li>
<li>
<p><strong><code>(a, a)</code></strong>, <code>ma</code>'s second argument is of type <code>(a, a)</code></p>
</li>
<li>
<p><strong><code>a</code></strong>, <code>ma</code>'s result is of type <code>a</code></p>
</li>
</ul>
<p>Note that <code>ma</code> therefore works on multiple types!
The only condition we imposed is that <code>a</code> should be a <code>Num</code>ber type.
In Clash this means it should support the operations <code>Prelude.+</code>, <code>Prelude.-</code>, <code>Prelude.*</code>, and some others.
Indeed, this is why Clash adds the constraint in the first place: the definition of <code>ma</code> uses <code>+</code> and <code>*</code>.
Whenever a function works over multiple types, we call it <em>polymorphic</em> ("poly" meaning "many", "morphic" meaning "forms").
While powerful, its not clear how Clash should synthesize this as numbers come in a great variety of (bit)sizes.
We will later see how to use this function in a <em>monomorphic</em> manner.</p>
<p>Talking about <em>types</em> also brings us to one of the most important parts of this tutorial: <em>types</em> and <em>synchronous sequential logic</em>.
Especially how we can always determine, through the types of a specification, if it describes combinational logic or (synchronous) sequential logic.
We do this by examining the definition of one of the sequential primitives, the <code>register</code> function:</p>
<pre><code class="language-haskell">register ::
  ( HiddenClockResetEnable dom
  , NFDataX a
  ) =&gt;
  a -&gt;
  Signal dom a -&gt;
  Signal dom a
register i s = ...
</code></pre>
<p>Where we see that the second argument and the result are not just of the <em>polymorphic</em> <code>a</code> type, but of the type: <code>Signal dom a</code>.
All (synchronous) sequential circuits work on values of type <code>Signal dom a</code>.
Combinational circuits always work on values of, well, not of type <code>Signal dom a</code>.
A <code>Signal</code> is an (infinite) list of samples, where the samples correspond to the values of the <code>Signal</code> at discrete, consecutive ticks of the <em>clock</em>.
All (sequential) components in the circuit are synchronized to this global <em>clock</em>.
For the rest of this tutorial, and probably at any moment where you will be working with Clash, you should probably not actively think about <code>Signal</code>s as infinite lists of samples, but just as values that are manipulated by sequential circuits.
To make this even easier, it is actually not possible to manipulate the underlying representation directly: you can only modify <code>Signal</code> values through a set of primitives such as the <code>register</code> function above.</p>
<p>Now, let us get back to the functionality of the <code>register</code> function: it is a simple <a href="https://en.wikipedia.org/wiki/Flip-flop_(electronics)">flip-flop</a> that only changes state at the tick of the global <em>clock</em>, and it has an initial value <code>a</code> which is its output at time 0.
We can further examine the <code>register</code> function by taking a look at the first 4 samples of the <code>register</code> functions applied to a constant signal with the value 8:</p>
<pre><code class="language-haskell">&gt;&gt;&gt; sampleN @System 4 (register 0 (pure (8 :: Signed 8)))
[0,0,8,8]
</code></pre>
<p>Where we see that the initial value of the signal is the specified 0 value, followed by 8's.
You might be surprised to see <em>two</em> zeros instead of just a single zero.
What happens is that in Clash you get to see the output of the circuit <em>before</em> the clock becomes active.
In other words, in Clash you get to describe the powerup values of registers too.
Whether this is a defined or unknown value depends on your hardware target, and can be configured by using a different synthesis <code>Domain</code>.
The default synthesis domain, <code>@System</code>, assumes that registers do have a powerup value - as is true for most FPGA platforms in most contexts.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../first-steps/working.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../first-steps/sequential.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../first-steps/working.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../first-steps/sequential.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
